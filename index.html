<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>배차 경로 안내</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <style>
        #map {
            width: 100%;
            height: 500px;
        }
        .address-list {
            max-height: 400px;
            overflow-y: auto;
        }
        .custom-overlay {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1;
            background: white;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            width: 300px;
        }
        .map-container {
            position: relative;
        }
    </style>
</head>
<body>
    <div class="container-fluid p-0">
        <div class="map-container">
            <div id="map"></div>
            <div class="custom-overlay">
                <div class="card">
                    <div class="card-header">
                        <h5>거래처 선택</h5>
                        <select id="companySelect" class="form-select mb-3">
                            <option value="">거래처를 선택하세요</option>
                        </select>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <h6>출발지 선택</h6>
                            <select id="startAddress" class="form-select">
                                <option value="">출발지를 선택하세요</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <h6>도착지 선택</h6>
                            <select id="endAddress" class="form-select">
                                <option value="">도착지를 선택하세요</option>
                            </select>
                        </div>
                        <button id="searchRoute" class="btn btn-primary w-100">경로 검색</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=595943c74a4a4d916c65d147ac95e009&libraries=services"></script>
    <script>
        // 카카오맵 초기화
        var mapContainer = document.getElementById('map');
        var mapOption = {
            center: new kakao.maps.LatLng(37.566826, 126.978656), // 서울시청 좌표
            level: 3
        };
        var map = new kakao.maps.Map(mapContainer, mapOption);
        var directionsService = new kakao.maps.services.Directions();
        var directionsRenderer = new kakao.maps.DirectionsRenderer({
            map: map
        });

        // 거래처 데이터 (실제로는 서버에서 가져와야 함)
        const companies = {
            "거래처1": [
                { name: "상차지1", address: "서울시 강남구" },
                { name: "하차지1", address: "서울시 서초구" }
            ],
            "거래처2": [
                { name: "상차지2", address: "서울시 송파구" },
                { name: "하차지2", address: "서울시 강동구" }
            ]
        };

        // 거래처 선택 옵션 생성
        const companySelect = document.getElementById('companySelect');
        Object.keys(companies).forEach(company => {
            const option = document.createElement('option');
            option.value = company;
            option.textContent = company;
            companySelect.appendChild(option);
        });

        // 거래처 선택 시 주소 목록 업데이트
        companySelect.addEventListener('change', function() {
            const selectedCompany = this.value;
            const startAddress = document.getElementById('startAddress');
            const endAddress = document.getElementById('endAddress');
            
            // 주소 목록 초기화
            startAddress.innerHTML = '<option value="">출발지를 선택하세요</option>';
            endAddress.innerHTML = '<option value="">도착지를 선택하세요</option>';

            if (selectedCompany) {
                companies[selectedCompany].forEach(location => {
                    const startOption = document.createElement('option');
                    startOption.value = location.address;
                    startOption.textContent = location.name;
                    startAddress.appendChild(startOption);

                    const endOption = document.createElement('option');
                    endOption.value = location.address;
                    endOption.textContent = location.name;
                    endAddress.appendChild(endOption);
                });
            }
        });

        // 경로 검색
        document.getElementById('searchRoute').addEventListener('click', function() {
            const startAddress = document.getElementById('startAddress').value;
            const endAddress = document.getElementById('endAddress').value;

            if (!startAddress || !endAddress) {
                alert('출발지와 도착지를 모두 선택해주세요.');
                return;
            }

            // 주소를 좌표로 변환
            const geocoder = new kakao.maps.services.Geocoder();
            
            geocoder.addressSearch(startAddress, function(result, status) {
                if (status === kakao.maps.services.Status.OK) {
                    const startCoords = new kakao.maps.LatLng(result[0].y, result[0].x);
                    
                    geocoder.addressSearch(endAddress, function(result, status) {
                        if (status === kakao.maps.services.Status.OK) {
                            const endCoords = new kakao.maps.LatLng(result[0].y, result[0].x);
                            
                            // 경로 검색
                            directionsService.route({
                                origin: startCoords,
                                destination: endCoords,
                                waypoints: [],
                                priority: kakao.maps.RoutePriority.FASTEST
                            }, function(result, status) {
                                if (status === kakao.maps.services.Status.OK) {
                                    directionsRenderer.setDirections(result);
                                } else {
                                    alert('경로를 찾을 수 없습니다.');
                                }
                            });
                        }
                    });
                }
            });
        });
    </script>
</body>
</html>
